<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase To-Do List</title>
    <style>
        :root {
            --primary-color: #4285F4;
            --secondary-color: #34A853;
            --danger-color: #EA4335;
            --light-color: #FFFFFF;
            --dark-color: #202124;
            --gray-color: #5F6368;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background-color: #F1F3F4;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary-color);
            color: var(--light-color);
            text-align: center;
            padding: 1rem;
            margin-bottom: 2rem;
        }

        h1, h2 {
            margin-bottom: 1rem;
        }

        #authSection, #todoSection {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        #todoSection {
            display: none;
        }

        input[type="email"],
        input[type="password"],
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 1rem;
            border: 1px solid var(--gray-color);
            border-radius: 4px;
            font-size: 1rem;
        }

        button {
            background-color: var(--primary-color);
            color: var(--light-color);
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #3367D6;
        }

        #googleSignInBtn {
            background-color: var(--danger-color);
        }

        #googleSignInBtn:hover {
            background-color: #C62828;
        }

        #userProfile {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        #userPhoto {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 1rem;
        }

        #userName {
            font-weight: bold;
            font-size: 1.2rem;
        }

        #taskList {
            list-style-type: none;
        }

        .task-item {
            background-color: #E8F0FE;
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .delete-btn {
            background-color: var(--danger-color);
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--secondary-color);
            color: var(--light-color);
            padding: 10px 20px;
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body>
    <header>
        <h1>Firebase To-Do List</h1>
    </header>

    <div class="container">
        <div id="authSection">
            <h2>Authentication</h2>
            <input type="email" id="emailInput" placeholder="Email">
            <input type="password" id="passwordInput" placeholder="Password">
            <button id="signupBtn">Sign Up</button>
            <button id="loginBtn">Login</button>
            <button id="googleSignInBtn">Sign In with Google</button>
        </div>

        <div id="todoSection">
            <div id="userProfile">
                <img id="userPhoto" src="/api/placeholder/50/50" alt="User profile">
                <span id="userName">User Name</span>
            </div>
            <h2>Your Tasks</h2>
            <input type="text" id="taskInput" placeholder="Enter a new task">
            <button id="addTaskBtn">Add Task</button>
            <ul id="taskList"></ul>
            <button id="signOutBtn">Sign Out</button>
        </div>
    </div>

    <div id="toast"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, where, orderBy } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD6AcC8ye33-y-Hk67He9-WHdIETssMPRY",
            authDomain: "enhtodo-va.firebaseapp.com",
            projectId: "enhtodo-va",
            storageBucket: "enhtodo-va.appspot.com",
            messagingSenderId: "328367594703",
            appId: "1:328367594703:web:f51cfb5ba0c0b6cd62abba"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        class TodoApp {
            constructor() {
                this.currentUser = null;
                this.tasks = [];
                this.initElements();
                this.initEventListeners();
                this.initAuth();
            }

            initElements() {
                this.authSection = document.getElementById('authSection');
                this.todoSection = document.getElementById('todoSection');
                this.emailInput = document.getElementById('emailInput');
                this.passwordInput = document.getElementById('passwordInput');
                this.signupBtn = document.getElementById('signupBtn');
                this.loginBtn = document.getElementById('loginBtn');
                this.googleSignInBtn = document.getElementById('googleSignInBtn');
                this.signOutBtn = document.getElementById('signOutBtn');
                this.taskInput = document.getElementById('taskInput');
                this.addTaskBtn = document.getElementById('addTaskBtn');
                this.taskList = document.getElementById('taskList');
                this.userPhoto = document.getElementById('userPhoto');
                this.userName = document.getElementById('userName');
                this.toast = document.getElementById('toast');
            }

            initEventListeners() {
                this.signupBtn.addEventListener('click', () => this.signup());
                this.loginBtn.addEventListener('click', () => this.login());
                this.googleSignInBtn.addEventListener('click', () => this.signInWithGoogle());
                this.signOutBtn.addEventListener('click', () => this.signOut());
                this.addTaskBtn.addEventListener('click', () => this.addTask());
                this.taskInput.addEventListener('keyup', (event) => {
                    if (event.key === 'Enter') this.addTask();
                });
            }

            initAuth() {
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        this.currentUser = user;
                        this.showTodoSection();
                        this.loadTasks();
                    } else {
                        this.currentUser = null;
                        this.showAuthSection();
                    }
                });
            }

            showAuthSection() {
                this.authSection.style.display = 'block';
                this.todoSection.style.display = 'none';
            }

            showTodoSection() {
                this.authSection.style.display = 'none';
                this.todoSection.style.display = 'block';
                this.updateUserProfile();
            }

            updateUserProfile() {
                this.userName.textContent = this.currentUser.displayName || this.currentUser.email;
                this.userPhoto.src = this.currentUser.photoURL || '/api/placeholder/50/50';
            }

            async signup() {
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, this.emailInput.value, this.passwordInput.value);
                    this.showToast('Signed up successfully');
                } catch (error) {
                    this.showToast('Error signing up: ' + error.message);
                }
            }

            async login() {
                try {
                    await signInWithEmailAndPassword(auth, this.emailInput.value, this.passwordInput.value);
                    this.showToast('Logged in successfully');
                } catch (error) {
                    this.showToast('Error logging in: ' + error.message);
                }
            }

            async signInWithGoogle() {
                const provider = new GoogleAuthProvider();
                try {
                    await signInWithPopup(auth, provider);
                    this.showToast('Signed in with Google successfully');
                } catch (error) {
                    this.showToast('Error signing in with Google: ' + error.message);
                }
            }

            async signOut() {
                try {
                    await signOut(auth);
                    this.showToast('Signed out successfully');
                } catch (error) {
                    this.showToast('Error signing out: ' + error.message);
                }
            }

            async addTask() {
                const taskText = this.taskInput.value.trim();
                if (taskText === '') return;

                try {
                    await addDoc(collection(db, 'tasks'), {
                        userId: this.currentUser.uid,
                        text: taskText,
                        createdAt: new Date()
                    });
                    this.taskInput.value = '';
                    this.showToast('Task added successfully');
                    await this.loadTasks();
                } catch (error) {
                    this.showToast('Error adding task: ' + error.message);
                }
            }

            async loadTasks() {
                try {
                    const q = query(
                        collection(db, 'tasks'),
                        where('userId', '==', this.currentUser.uid),
                        orderBy('createdAt', 'desc')
                    );
                    const querySnapshot = await getDocs(q);
                    this.tasks = querySnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    this.renderTasks();
                } catch (error) {
                    this.showToast('Error loading tasks: ' + error.message);
                }
            }

            async deleteTask(taskId) {
                try {
                    await deleteDoc(doc(db, 'tasks', taskId));
                    this.showToast('Task deleted successfully');
                    await this.loadTasks();
                } catch (error) {
                    this.showToast('Error deleting task: ' + error.message);
                }
            }

            renderTasks() {
                this.taskList.innerHTML = '';
                this.tasks.forEach(task => {
                    const li = document.createElement('li');
                    li.className = 'task-item';
                    li.innerHTML = `
                        <span>${task.text}</span>
                        <button class="delete-btn">Delete</button>
                    `;
                    li.querySelector('.delete-btn').addEventListener('click', () => this.deleteTask(task.id));
                    this.taskList.appendChild(li);
                });
            }

            showToast(message) {
                this.toast.textContent = message;
                this.toast.style.opacity = 1;
                setTimeout(() => {
                    this.toast.style.opacity = 0;
                }, 3000);
            }
        }

        new TodoApp();
    </script>
</body>
</html>
